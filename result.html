<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TODAY OLD POP</title>
  <link rel="stylesheet" href="./common.css">
  <link rel="stylesheet" href="./result.css">

</head>

<body>
  <!--header-->
  <header class="layout-header">
    <h1>TODAY OLD POP</h1>
  </header>
  <!--//header-->

  <!--main-->
  <main class="result-page">
      <img class="photo" src="001.jpg" alt="흑백사진">
      <div class="right-content">
        <h3 class="result-title">당신을 위한 OLD POP</h3>
        <div class="result-container">
          <div id="loading-message" class="loading-message">Loading...</div>
          <div id="result-content" class="result-content"></div>
      
          <button class="again-btn" type="button" onclick="ToMainPage()">다시하기</button>
        </div>
      </div>
  </main>
  <!--//main-->

  <!--script-->
  <script>
    const urlSearchParams = new URLSearchParams(window.location.search);
    const params = Object.fromEntries(urlSearchParams.entries());
    const url = "https://estsoft-openai-api.jejucodingcamp.workers.dev/";
    const questionData = [
      {"role": "system", "content": "assistant는 올드팝 전문가이다."},
      {"role": "user", "content": `${params.season}에 어울리는 ${params.tempo} 올드팝을 추천해줘. ${params.sound} 소리가 들어간 노래였으면 좋겠어. 결과는 다른 말은 하지 말고 가수-노래제목(발매년도)만 한 줄씩 표시해줘. 노래는 최대 5개만 알려주면 돼. 노래 5개는 매번 랜덤으로 선정해줘.`}
    ];

    fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(questionData),
      redirect: "follow",
    })
    .then(response => response.json())
    .then(data => {
      const resultContent = data.choices[0].message.content;
      document.getElementById("loading-message").style.display = "none";
      document.getElementById("result-content").innerText = resultContent;
      document.getElementById("result-content").style.display = "block";
    })

    function ToMainPage() {
      window.location.href = "index.html";
    }
  </script>
  <!--//script-->

  <!--footer-->
  <footer class="layout-footer">
    Copyright 2023.TodayOldPop
  </footer>
  <!--//footer-->
</body>
</html>